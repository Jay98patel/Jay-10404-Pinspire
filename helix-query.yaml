version: 1

indices:
  # Existing index (leave as-is if youâ€™re still using /query-index.json elsewhere)
  # query-index:
  #   ...

  pi-ideas:
    # Only index idea detail pages
    include:
      - '/ideas/**'
    exclude:
      - '/icons/**'
      - '/fonts/**'
      - '/styles/**'
      - '/scripts/**'
      - '/blocks/**'
      - '/tools/**'
      - '/metadata/**'
      - '/favicon.ico'
      - '/404*'

    # The JSON URL your JS will fetch
    target: /pi-ideas-index.json

    properties:
      path:
        select: path

      id:
        select: head > meta[name="id"]
        value: |
          attribute(el, 'content')

      title:
        select: head > meta[property="og:title"]
        value: |
          attribute(el, 'content')

      description:
        select: head > meta[name="description"]
        value: |
          attribute(el, 'content')

      # ðŸ”´ Take the hero image from the document itself
      image:
        # first image in main (covers both <img> and <picture><img>)
        select: main picture img, main img
        value: |
          # strip domain: https://.../icons/foo.png -> /icons/foo.png...
          match(attribute(el, 'src'), 'https:\/\/[^/]+(\/.*)')

      category:
        select: head > meta[name="category"]
        value: |
          attribute(el, 'content')

      tags:
        select: head > meta[name="article:tag"]
        value: |
          attribute(el, 'content')

      createdAt:
        select: head > meta[name="createdAt"]
        value: |
          attribute(el, 'content')

      isTrending:
        select: head > meta[name="isTrending"]
        value: |
          attribute(el, 'content')

      lastModified:
        select: none
        value: |
          parseTimestamp(headers['last-modified'], 'ddd, DD MMM YYYY hh:mm:ss GMT')
