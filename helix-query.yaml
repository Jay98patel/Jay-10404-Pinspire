version: 1

indices:
  ideas:
    include:
      - '/ideas/**'
    exclude:
      - '/icons/**'
      - '/fonts/**'
      - '/styles/**'
      - '/scripts/**'
      - '/blocks/**'
      - '/tools/**'
      - '/metadata/**'
      - '/favicon.ico'
      - '/404*'
    target: /query-index.json

    properties:
      path:
        select: path

      id:
        select: head > meta[name="id"]
        value: |
          attribute(el, 'content')

      title:
        select: head > meta[property="og:title"]
        value: |
          attribute(el, 'content')

      description:
        select: head > meta[name="description"]
        value: |
          attribute(el, 'content')

      image:
        # take the OG image and strip the domain â†’ "/icons/..."
        select: head > meta[property="og:image"]
        value: |
          match(attribute(el, 'content'), 'https:\/\/[^/]+(\/.*)')

      category:
        select: head > meta[name="category"]
        value: |
          attribute(el, 'content')

      tags:
        select: head > meta[name="article:tag"]
        value: |
          attribute(el, 'content')

      createdAt:
        select: head > meta[name="createdAt"]
        value: |
          attribute(el, 'content')

      isTrending:
        select: head > meta[name="isTrending"]
        value: |
          attribute(el, 'content')

      lastModified:
        select: none
        value: |
          parseTimestamp(headers['last-modified'], 'ddd, DD MMM YYYY hh:mm:ss GMT')
