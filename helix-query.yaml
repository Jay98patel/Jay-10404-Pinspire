version: 1

indices:
  pi-ideas:
    # only idea detail pages
    include:
      - '/ideas/**'
    exclude:
      - '/icons/**'
      - '/fonts/**'
      - '/styles/**'
      - '/scripts/**'
      - '/blocks/**'
      - '/tools/**'
      - '/metadata/**'
      - '/favicon.ico'
      - '/404*'
    # NEW: dedicated ideas index
    target: /pi-ideas-index.json

    properties:
      path:
        select: path

      id:
        select: head > meta[name="id"]
        value: |
          attribute(el, 'content')

      title:
        select: head > meta[property="og:title"]
        value: |
          attribute(el, 'content')

      description:
        select: head > meta[name="description"]
        value: |
          attribute(el, 'content')

      # ðŸ”´ IMPORTANT: pick the hero image from the document itself
      image:
        # first <img> inside <main> on the idea page
        select: main img
        value: |
          # strip the domain, keep the relative path (e.g. /icons/pinspire-og-sunset-hike.png?width=1200...)
          match(attribute(el, 'src'), 'https:\/\/[^/]+(\/.*)')

      category:
        select: head > meta[name="category"]
        value: |
          attribute(el, 'content')

      tags:
        select: head > meta[name="article:tag"]
        value: |
          attribute(el, 'content')

      createdAt:
        select: head > meta[name="createdAt"]
        value: |
          attribute(el, 'content')

      isTrending:
        select: head > meta[name="isTrending"]
        value: |
          attribute(el, 'content')

      lastModified:
        select: none
        value: |
          parseTimestamp(headers['last-modified'], 'ddd, DD MMM YYYY hh:mm:ss GMT')
