version: 1

indices:
  ideas:
    include:
      - '/ideas/**'
    exclude:
      - '/icons/**'
      - '/fonts/**'
      - '/styles/**'
      - '/scripts/**'
      - '/blocks/**'
      - '/tools/**'
      - '/metadata/**'
      - '/favicon.ico'
      - '/404*'
    target: /query-index.json

    properties:
      id:
        selectFirst: head > meta[name="id"]
        value: |
          attribute(el, 'content')

      title:
        selectFirst: head > meta[property="og:title"]
        value: |
          attribute(el, 'content')

      description:
        selectFirst: head > meta[name="description"]
        value: |
          attribute(el, 'content')

      image:
        selectFirst: head > meta[property="og:image"]
        value: |
          match(attribute(el, 'content'), 'https:\/\/[^/]+(\/.*)')

      category:
        selectFirst: head > meta[name="category"]
        value: |
          attribute(el, 'content')

      tags:
        select: head > meta[property="article:tag"]
        value: |
          attribute(el, 'content')

      createdAt:
        selectFirst: head > meta[name="createdat"], head > meta[name="createdAt"]
        value: |
          attribute(el, 'content')

      isTrending:
        selectFirst: head > meta[name="istrending"], head > meta[name="isTrending"]
        value: |
          attribute(el, 'content')

      lastModified:
        selectFirst: none
        value: |
          parseTimestamp(headers['last-modified'], 'ddd, DD MMM YYYY hh:mm:ss GMT')
